### 数据结构

- [一次采集]
  - image_00
    - data
      - **[timestamp].png**
      - ...
    - **timestamps.txt**
  - image_01
    - ...
  - image_02
    - ...
  - image_03
    - ...
  - oxts
    - data
      - **[timestamp].txt**
      - ...
    - **timestamps.txt**
  - velodyne_points
    - data
      - **[timestamp].bin**
    - **timestamps.txt**
    - **timestamps_end.txt**
    - **timestamps_start.txt**
  - **tracklet_label.xml**

### **流和时间戳的一般信息**

所有传感器的数据流都存储在各自的文件夹中，并且都有时间戳文件记录每帧的时间戳（精确到纳秒）。每个数据流的编号相互对应，并与时间戳文件中的行号匹配，所有数据已同步。所有相机都由Velodyne激光雷达直接触发，GPS/IMU数据（记录频率为100Hz）则与相应的参考帧对齐。

### 1. **摄像机数据**
- **摄像机数量**：KITTI数据集使用了**4台摄像机**，分别是：
  - 2台灰度相机（stereo grayscale）
    - `image_00`: 左侧灰度相机
    - `image_01`: 右侧灰度相机
  - 2台彩色相机（stereo color）
    - `image_02`: 左侧彩色相机
    - `image_03`: 右侧彩色相机
- **分辨率**：所有摄像机的图像分辨率为**1382x512像素**，经过校正后会稍有减少。
- **采集频率**：所有摄像机的帧率约为**10 Hz**，即每秒采集约10帧图像。相机图像与Velodyne激光雷达同步，触发点是Velodyne面向车辆前方时采集图像。

### 2. **oxts (GPS/IMU数据)**
`oxts`文件夹存储的是车辆在每一帧的GPS/IMU数据。每帧的数据以`.txt`文件格式保存，文件内包含30个值，主要包括以下几类信息：
- **位置信息**：
  - `lat`：纬度（degree）
  - `lon`：经度（degree）
  - `alt`：高度（米）
- **姿态信息**：
  - `roll`：滚转角（弧度，-π 到 π，正值表示左侧抬高）
  - `pitch`：俯仰角（弧度，-π/2 到 π/2，正值表示前方向下）
  - `yaw`：偏航角（弧度，-π 到 π，正值表示逆时针旋转）
- **速度信息**：
  - `vn`：朝北方向的速度（米/秒）
  - `ve`：朝东方向的速度（米/秒）
  - `vf`：前向速度（平行于地面的速度，米/秒）
  - `vl`：左向速度（平行于地面的速度，米/秒）
  - `vu`：向上的速度（垂直于地面的速度，米/秒）
- **加速度**：
  - `ax`：前向加速度（米/秒²）
  - `ay`：左向加速度（米/秒²）
  - `az`：向上加速度（米/秒²）
- **角速度**：
  - `wx`：绕x轴的角速度（弧度/秒）
  - `wy`：绕y轴的角速度（弧度/秒）
  - `wz`：绕z轴的角速度（弧度/秒）
  
- **pos_accuracy 和 vel_accuracy**：
  
  - **pos_accuracy**：位置精度，表示北向和东方向上的位置误差，单位为米。
  - **vel_accuracy**：速度精度，表示北向和东方向上的速度误差，单位为米/秒。
  
  这两个值通常用于衡量GPS/IMU系统在定位和速度估算中的准确性，误差越小表示精度越高。
  
- **navstat**：

  - **导航状态**，表示当前导航状态。通常是一个数值，可能需要通过`navstat_to_string`函数或映射表来解码为可读的状态信息，如GPS锁定状态。

- **numsats**：

  - **卫星数量**，表示主要GPS接收器正在跟踪的卫星数量。该值越大，GPS定位的精度通常越高。

- **posmode**、**velmode**、**orimode**：

  - **posmode**：GPS接收器的定位模式，通过`gps_mode_to_string`解码。表示当前的GPS定位模式，例如3D定位或差分GPS定位等。
  - **velmode**：速度模式，同样通过`gps_mode_to_string`解码，表示当前的GPS速度模式。
  - **orimode**：方向模式，通过`gps_mode_to_string`解码，表示GPS的方向模式。

### 3. **Velodyne激光雷达数据**
`velodyne_points`文件夹存储的是Velodyne激光雷达采集的3D点云数据，格式为二进制文件（`.bin`），每个文件对应一帧数据。

- **数据格式**：每个`.bin`文件包含以**浮点数（float32）**存储的点云数据，每个点由4个值组成，依次为：
  - `x`：点的x坐标（以激光雷达为参考，单位为米）
  - `y`：点的y坐标（单位为米）
  - `z`：点的z坐标（单位为米）
  - `r`：点的反射率（reflectance，描述激光反射的强度）

Velodyne激光雷达旋转时连续采集点云，点云数据的采集频率为**10 Hz**，与相机图像同步。

### 4. **标注格式（tracklets_labels.xml）**
通过解析该`tracklet_labels.xml`文件，我们可以看到它包含了多个对象的详细信息。每个对象的标签和位置信息是按照帧序列存储的。以下是文件中包含的主要信息类型和格式：

#### 1. **对象类型 (`objectType`)**

- 描述：物体的类别
  - 'Car'
  - 'Van'
  - 'Truck'
  - 'Pedestrian'
  - 'Person (sitting)'
  - 'Cyclist'
  - 'Tram'
  - 'Misc'

- 格式：字符串

#### 2. **物体尺寸**

- **高度 (`h`)**：物体的高度（单位：米）。
- **宽度 (`w`)**：物体的宽度（单位：米）。
- **长度 (`l`)**：物体的长度（单位：米）。
- 格式：浮点数

#### 3. **帧信息**

- **`first_frame`**：该物体第一次出现的帧编号。
- 格式：整数

#### 4. **物体位置与姿态 (`poses`)**

- 每个物体的位置信息包括：
  - **`tx`**：物体在x方向的平移量（单位：米）。
  - **`ty`**：物体在y方向的平移量（单位：米）。
  - **`tz`**：物体在z方向的平移量（单位：米）。
  - **`rx`**：物体在x方向的旋转角度（单位：弧度）。
  - **`ry`**：物体在y方向的旋转角度（单位：弧度）。
  - **`rz`**：物体在z方向的旋转角度（单位：弧度）。
  - 格式：浮点数

#### 5. **遮挡信息**

- **`occlusion`**：物体的遮挡程度（0表示没有遮挡，1表示部分遮挡，2表示完全遮挡）。
- **`occlusion_kf`**：关键帧的遮挡标志。
- 格式：整数

#### 6. **截断信息**

- **`truncation`**：物体是否被截断（0表示没有截断，1表示部分截断）。
- 格式：整数

#### 7. **边界信息**

- **`amt_border_l`**：左边界与物体的距离。
- **`amt_border_r`**：右边界与物体的距离。
- 格式：浮点数

#### 8. **物体状态 (`state`)**

- 描述：物体的状态（例如，静止或移动）。
- 格式：整数

#### 9. **其他信息**

- **`amt_occlusion`**：遮挡的程度。
- **`amt_occlusion_kf`**：关键帧中的遮挡程度。
- 格式：整数

#### 总结：

该XML文件包含了物体的类别、尺寸、每一帧中的位置、旋转信息、遮挡信息、截断信息等。这些信息以层级结构组织，每个对象的位置信息通过多个`item`标签存储，描述了其在不同帧中的表现。

### 5. **坐标系**

KITTI数据集中的不同传感器使用了不同的坐标系：

- **相机坐标系**：x向右，y向下，z向前
- **Velodyne坐标系**：x向前，y向左，z向上
- **GPS/IMU坐标系**：x向前，y向左，z向上

所有坐标系都是右手系。

在KITTI数据集中，标定（校准）相关的数据存储在多个文件中，主要涉及相机、Velodyne激光雷达以及GPS/IMU的校准。每个文件中包含的矩阵和参数信息，用于将不同传感器的数据对齐到统一的坐标系。以下是各个校准文件的具体格式：

### 6. 标定

#### 1. **calib_cam_to_cam.txt**：相机间的校准数据
   这个文件包含了相机到相机之间的内外参数校准信息。

   - **S_xx**：1x2的图像大小（在校正前的图像分辨率）。
   - **K_xx**：3x3的相机内参矩阵，格式如下：
     ```
     [ fx  0  cx ]
     [ 0  fy  cy ]
     [ 0   0   1 ]
     ```
     其中，`fx`和`fy`是焦距，`cx`和`cy`是主点坐标。
   - **D_xx**：1x5的畸变向量，包含径向和切向畸变系数。
   - **R_xx**：3x3的旋转矩阵，表示相机之间的旋转关系（外参）。
   - **T_xx**：3x1的平移向量，表示相机之间的平移关系（外参）。
   - **S_rect_xx**：1x2的图像大小（校正后的图像分辨率）。
   - **R_rect_xx**：3x3的图像校正旋转矩阵，使得图像平面共面。
   - **P_rect_xx**：3x4的校正投影矩阵，通常在使用时只需要这个矩阵即可。
     ```
     [ fx'  0   cx'  Tx ]
     [  0  fy'  cy'  Ty ]
     [  0   0    1    0 ]
     ```

#### 2. **calib_velo_to_cam.txt**：Velodyne到相机的校准
   - **R**：3x3的旋转矩阵，用于将Velodyne激光雷达坐标转换为相机坐标系。
   - **T**：3x1的平移向量，用于将Velodyne激光雷达坐标平移到相机坐标系。

   这个矩阵组合了旋转和平移，用于将激光雷达数据转换为相机坐标。

#### 3. **calib_imu_to_velo.txt**：GPS/IMU到Velodyne的校准
   - **R**：3x3的旋转矩阵，用于将GPS/IMU坐标转换为Velodyne坐标系。
   - **T**：3x1的平移向量，用于将GPS/IMU坐标平移到Velodyne坐标系。

#### 4. **转换关系**
   传感器数据之间的转换关系可以通过一系列矩阵运算实现，例如：

   - 从Velodyne坐标系转换到相机坐标系：
     ```
     Y = P_rect_xx * R_rect_00 * (R|T)_velo_to_cam * X
     ```
     其中，`X`是Velodyne坐标下的点，`Y`是图像平面上的点。

   - 从GPS/IMU坐标转换到图像平面：
     ```
     Y = P_rect_xx * R_rect_00 * (R|T)_velo_to_cam * (R|T)_imu_to_velo * X
     ```

这些校准数据可以用来精确对齐各个传感器的测量数据，从而生成如3D点云与2D图像的联合表示。
